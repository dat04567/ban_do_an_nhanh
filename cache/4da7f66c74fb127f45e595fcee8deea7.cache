a:2:{s:7:"expires";i:1733882147;s:5:"value";a:2:{s:4:"data";a:2:{i:0;a:8:{s:9:"idSanPham";s:36:"3906523c-4738-4ddb-82fc-bf54c82bb80b";s:10:"tenSanPham";s:15:"Bánh chocolate";s:3:"gia";s:9:"130000.00";s:6:"tonKho";i:3;s:7:"hinhAnh";s:111:"/assets/images/products/img_6756d1936c7ed5.22648104.svg;/assets/images/products/img_6756d1936dfc77.14561537.svg";s:10:"tenDanhMuc";s:23:"Bánh,Bánh quy hãng A";s:9:"idCuaHang";s:36:"e9925254-9f8d-11ef-9429-5f9befd974b8";s:10:"tenCuaHang";s:17:"Pizza Express 24h";}i:1;a:8:{s:9:"idSanPham";s:36:"ce929782-40bf-411c-b553-35e22d6c99f4";s:10:"tenSanPham";s:9:"Bánh lan";s:3:"gia";s:9:"120000.00";s:6:"tonKho";N;s:7:"hinhAnh";s:223:"/assets/images/products/img_6756947a452431.26217853.svg;/assets/images/products/img_6756947a482626.29909536.svg;/assets/images/products/img_6756947a561c36.19250744.svg;/assets/images/products/img_6756947a587913.55334755.svg";s:10:"tenDanhMuc";s:5:"Bánh";s:9:"idCuaHang";N;s:10:"tenCuaHang";N;}}s:3:"sql";s:2940:"SELECT 
                                          SP.idSanPham,
                                          SP.tenSanPham AS tenSanPham, 
                                          SP.price AS gia ,
                                          KSP.soLuongTonKho AS tonKho,
                                          GROUP_CONCAT(DISTINCT HA.duongDan SEPARATOR ';') AS hinhAnh,
                                          GROUP_CONCAT(DISTINCT DMC.tenDanhMucCon SEPARATOR ',') AS tenDanhMuc,
                                          KSP.idCuaHang as idCuaHang,
                                          CH.storeName as tenCuaHang
                                          FROM 
                                             SanPham SP
                                          LEFT JOIN 
                                             SanPhamDanhMuc SPDM ON SP.idSanPham = SPDM.idSanPham
                                          LEFT JOIN 
                                             DanhMucCon DMC ON SPDM.idDanhMucCon = DMC.idDanhMucCon
                                          LEFT JOIN 
                                             HinhAnh HA ON SP.idSanPham = HA.idSanPham
                                          LEFT JOIN
                                          (
                                             SELECT 
                                                idSanPham, 
                                                soLuongTonKho,
                                                idCuaHang,
                                                ROW_NUMBER() OVER (
                                                   PARTITION BY idSanPham 
                                                   ORDER BY 
                                                      soLuongTonKho DESC,  -- Ưu tiên kho có nhiều hàng
                                                      idCuaHang  -- Thứ tự phụ để đảm bảo tính nhất quán
                                                ) as store_rank
                                             FROM 
                                                KhoSanPham
                                             WHERE 
                                                soLuongTonKho > 0
                                          ) KSP ON SP.idSanPham = KSP.idSanPham AND KSP.store_rank = 1
                                          LEFT JOIN 
                                             CuaHang CH ON KSP.idCuaHang = CH.idCuaHang   
                                          WHERE 
                                             SP.isDeleted = FALSE
                                          GROUP BY    
                                             SP.idSanPham, SP.tenSanPham, SP.price, KSP.soLuongTonKho, KSP.idCuaHang, CH.storeName
                                          ORDER BY
                                             SP.createAt DESC
                                          LIMIT 10";}}